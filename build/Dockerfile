FROM debian:stable-20251020-slim

RUN apt-get update  \
    && apt-get -y --no-install-recommends install \
        sudo curl git ca-certificates build-essential \
    && rm -rf /var/lib/apt/lists/*

ARG USERNAME=toolbox
ARG USER_UID=1000
ARG USER_GID=1000

RUN groupadd --gid $USER_GID $USERNAME \
    && useradd --uid $USER_UID --gid $USER_GID -m $USERNAME \
    && echo "$USERNAME ALL=(ALL) NOPASSWD: ALL" >> /etc/sudoers

SHELL ["/bin/bash", "-o", "pipefail", "-c"]
ENV MISE_DATA_DIR="/mise"
ENV MISE_CONFIG_DIR="/mise"
ENV MISE_CACHE_DIR="/mise/cache"
ENV MISE_INSTALL_PATH="/usr/local/bin/mise"
ENV MISE_TRUSTED_CONFIG_PATHS="/"
ENV PATH="/mise/shims:$PATH"
ENV MISE_VERSION="v2025.10.21"

# todo: use the pre-build mise binary, instead of piping a shell script:
RUN curl https://mise.run | sh
#COPY ./build/mise /usr/local/bin/mise
#RUN chmod 775 /usr/local/bin/mise

# note: the `./build/mise` file was generated by `mise generate bootstrap`, speeding up the building of this container
# by a lot.
# see https://mise.jdx.dev/continuous-integration.html
#> An alternative to calling `curl https://mise.run | sh` is to use `mise generate bootstrap` to generate a script
#> that runs and install mise.

USER $USERNAME
